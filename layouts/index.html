{{ define "head" }}
  {{ partial "meta/inline-postcss.html" (resources.Get "css/pages/home.css") }}
  {{ partial "meta/async-postcss.html" (resources.Get "css/pages/home-async.css") }}
{{ end }}
{{ define "rss" }}
  {{ range (.GetPage "posts").AlternativeOutputFormats }}
  <link rel="{{.Rel}}" type="{{.MediaType.Type}}" href="{{.Permalink}}" title="{{$.Site.Title}}">
  {{ end }}
{{ end }}
{{ define "main" }}
  <section class="card header about">
    <div class="inner about__content">
      <div>
        {{ partialCached "logo.html" (dict "width" 320 "height" 64 "outline" true) "home" }}
        {{.Content}}
      </div>

      {{ with .Resources.GetMatch "profile.jpg" }}
      {{ $srcset := slice (.Resize "160x") (.Resize "320x") (.Resize "480x") (.Resize "640x") }}
      <img class="profile" width="160" height="160" sizes="160px" alt="Portrait of Tiger Oakes"
        src="{{.RelPermalink}}"
        srcset='{{ partial "srcset" $srcset | safeHTMLAttr }}'>
      {{ end }}
    </div>
  </section>

  <section class="previews">
    <div class="inner">
      <h2 class="section__title">
        Latest posts
      </h2>
      <ul class="preview__list">
      {{ range (.GetPage "posts").RegularPages | first 3 }}
      {{ .Render "preview/latest" }}
      {{ end }}
      </ul>

      <h2 class="section__title">
        Popular content
      </h2>
      <ul class="preview__list">
      {{- $content := append (.GetPage "posts").RegularPages (.GetPage "talks").RegularPages -}}
      {{ range sort (partial "func/feature.html" $content) ".Date" "desc" }}
      {{ .Render "preview/latest" }}
      {{ end }}
      </ul>

      <footer class="preview__cta">
        <a class="shadow button" href="/posts/">
          {{ i18n "view_all" }}
        </a>
      </footer>
    </div>
  </section>

  <section class="featured-projects projects" id="featured">
    {{- $projects := partial "func/feature.html" (.GetPage "projects").Pages -}}
    {{- $lastIndex := sub (len $projects) 1 -}}
    {{ range $index, $project := $projects }}
    <article class="card card--image featured-project" style='{{ partial "project/style.css" $project | safeCSS }}'>
      <div class="inner">
        {{ if eq $index 0 }}
        <h2 class="section__title projects__title">
          Featured projects
        </h2>
        {{ end }}
        <h3 class="block--side card__title">{{$project.Title}}</h3>
        {{ partial "project/tech_list.html" $project.Params.tech }}
        <p class="card__description">
          {{$project.Description | default $project.Summary}}
        </p>
        {{ partial "project/buttons.html" (dict "links" $project.Params.links "page" $project.RelPermalink) }}
      </div>
      {{ if eq $index $lastIndex }}
      <footer class="cta__wrap">
        <a class="shadow button" href="/projects/">
          {{ i18n "see_more" }}
        </a>
      </footer>
      {{ end }}
    </article>
    {{ end }}
  </section>
{{ end }}
{{ define "footer" }}
  <footer class="contact" id="contact" role="contentinfo">
    <h2 class="section__title">Contact</h2>
    <p>You can send an email to</p>
    {{ with .Site.Data.contact.email }}
    <a href="{{ .link }}" class="block--bottom block--animate contact__link email">
      {{ .text | markdownify }}
    </a>
    {{ end }}
    <p>{{ i18n "find_at" }}</p>
    {{ range .Site.Data.contact.social }}
    <p class="contact__link-container">
    <a href="{{ .link }}" class="block--bottom block--animate contact__link">
      {{ .text | markdownify }}
    </a>
    </p>
    {{ end }}
  </footer>
{{ end }}
