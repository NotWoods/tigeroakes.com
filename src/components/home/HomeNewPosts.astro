---
import ListFlat from '../lists/ListFlat.astro';
import { loadPosts, postAccentColor, type Post } from '../../scripts/posts';

const allPosts = await loadPosts(Astro.glob('../../pages/posts/*/*.{md,mdx}'));
const featured = allPosts.filter((post) =>
  post.frontmatter.categories?.includes('Feature')
);

function formatPost(post: Post) {
  return {
    title: post.frontmatter.title,
    description: post.frontmatter.description,
    date: post.date,
    accent: postAccentColor(post.frontmatter.tags),
    href: post.url,
    pictureSrc: post.banner,
    pictureAlt: post.frontmatter.banner_alt,
  };
}
---

<section id="previews" class="max-w-site mx-auto px-4 py-8">
  <ListFlat title="Latest posts" items={allPosts.slice(0, 3).map(formatPost)} />
  <ListFlat
    title="Popular content"
    items={featured.slice(0, 3).map(formatPost)}
  />
</section>
