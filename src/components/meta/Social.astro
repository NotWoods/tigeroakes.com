---
import Image from '@11ty/eleventy-img';
import { basename, dirname } from 'path';
import OpenGraph from "./OpenGraph.astro";
import Twitter from "./Twitter.astro";

export interface Props {
  title: string;
  description: string;
  pictureSrc?: string;
  pictureAlt?: string;
}

const { title, description, pictureSrc, pictureAlt } = Astro.props as Props;

let src: string | undefined;
if (pictureSrc) {
  const metadata = await Image(pictureSrc, {
    outputDir: `${import.meta.env.PROD ? 'dist' : 'static'}/assets/images`,
    urlPath: '/assets/images',
    formats: ['png'],
    svgShortCircuit: false,
    filenameFormat(id: string, src: string, width: string, format: string) {
      const parentFolder = basename(dirname(src));
      return `${parentFolder}-banner.${id}.${format}`;
    }
  });
  src = metadata.png[0].url;
}
---

<OpenGraph {title} {description} {pictureAlt} pictureSrc={src} />
<Twitter {title} {description} {pictureAlt} pictureSrc={src} />
