---
import Image from '@11ty/eleventy-img';
import { imageOptions, parentFolder } from '../eleventy-img/options';
import OpenGraph from './OpenGraph.astro';
import Twitter from './Twitter.astro';

export interface Props {
  title: string;
  description: string;
  pictureSrc?: string;
  pictureAlt?: string;
}

const { title, description, pictureSrc, pictureAlt } = Astro.props as Props;

let src: string | undefined;
if (pictureSrc) {
  const metadata = await Image(pictureSrc, {
    ...imageOptions,
    formats: ['png'],
    svgShortCircuit: false,
    filenameFormat(id: string, src: string, width: number, format: string) {
      return `${parentFolder(src)}-banner.${id}.${format}`;
    },
  });
  src = metadata.png[0].url;
  console.log(src);
}
---

<OpenGraph {title} {description} {pictureAlt} pictureSrc={src} />
<Twitter {title} {description} {pictureAlt} pictureSrc={src} />
