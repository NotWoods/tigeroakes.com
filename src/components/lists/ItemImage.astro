---
import Image from '@11ty/eleventy-img';
import GeneratePicture from '../eleventy-img/GeneratePicture.astro';
import { imageOptions } from '../eleventy-img/options';

export interface Props {
  src: string;
  alt?: string;
  width: number;
  sizes: string;
  class?: string;
  fit?: 'cover' | 'contain';
  loading?: 'eager' | 'lazy';
  aspect: 'half' | 'video';
}

const {
  src,
  alt = '',
  fit,
  width,
  aspect,
  sizes,
  loading = 'lazy',
  class: className,
} = Astro.props as Props;
const imgClass = fit === 'contain' ? 'object-contain' : 'object-cover';
const pictureClass = [
  `block mb-2 shadow-md bg-slate-200`,
  aspect === 'half' && 'aspect-w-2 aspect-h-1',
  aspect === 'video' && 'aspect-w-16 aspect-h-9',
  className,
]
  .filter(Boolean)
  .join(' ');

const metadata = await Image(src, {
  ...imageOptions,
  widths: [width, width * 2, width * 4],
  formats: ['avif', 'webp', null],
  svgShortCircuit: true,
});

const attributes = {
  alt,
  sizes,
  loading,
  decoding: 'async',
};
---

<GeneratePicture {metadata} {attributes} {pictureClass} {imgClass} />
