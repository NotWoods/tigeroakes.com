---
import type { ImageMetadata } from 'astro';
import { Picture } from 'astro:assets';
import type { ImageFormat } from '../../scripts/picture';

export interface Props {
  src: ImageMetadata;
  alt?: string;
  width: number;
  sizes: string;
  class?: string;
  fit?: 'cover' | 'contain';
  loading?: 'eager' | 'lazy';
  aspect: 'half' | 'video';
}

const {
  src: metadata,
  alt = '',
  fit,
  width,
  aspect,
  sizes,
  loading = 'lazy',
  class: className,
} = Astro.props as Props;
const imgClass = [
  fit === 'contain' ? 'object-contain' : 'object-cover',
  'shadow-md bg-slate-200 h-full',
  className,
]
  .filter(Boolean)
  .join(' ');
const heightClass = aspect === 'half' ? 'h-[2.9375rem]' : 'h-[3.305rem]';

const formats: ImageFormat[] =
  metadata.format === 'svg' ? ['svg'] : ['avif', 'webp', metadata.format];
const widths = [width, width * 2, width * 4];
---

<Picture
  src={metadata}
  {alt}
  {loading}
  {sizes}
  class={imgClass}
  pictureAttributes={{ class: `mb-2 ${heightClass}` }}
  {formats}
  {widths}
/>
