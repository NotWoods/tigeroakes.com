---
import Image from '@11ty/eleventy-img';
import GeneratePicture from '../eleventy-img/GeneratePicture.astro';
import { imageOptions } from '../eleventy-img/options';

export interface Props {
  src: string;
  alt?: string;
  height: number;
  class?: string;
  fit?: 'cover' | 'contain';
}

const { src, alt = '', fit, height, class: className } = Astro.props as Props;
const width = height * 2;
const imgClass = fit === 'contain' ? 'object-contain' : 'object-cover';
const pictureClass = [`block mb-2 shadow-md aspect-w-2 aspect-h-1`, className]
  .filter(Boolean)
  .join(' ');

const metadata = await Image(src, {
  ...imageOptions,
  widths: [width],
  formats: ['avif', 'webp', 'png'],
  svgShortCircuit: true,
});

const attributes = {
  alt,
  loading: 'lazy',
  decoding: 'async',
};
---

<GeneratePicture {metadata} {attributes} {pictureClass} {imgClass} />
